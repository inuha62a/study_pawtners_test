<h1>学習記録の作成</h1>

<% if @study.errors.any? %>
  <div style="color: red;">
    <ul>
      <% @study.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<h2><%= action_name == "new" ? "新規学習記録作成" : "学習記録編集" %></h2>

<%= form_with model: @study, local: true do |f| %>
  <div>
    <%= f.label :date, "学習日" %>
    <%= f.date_field :date %>
  </div>

  <% if @contents.any? %>
  <div>
    <h3>学習項目（チェックしてください）</h3>
    <% @contents.each do |content| %>
      <div>
        <% checked = @study&.content_names&.include?(content.name) || false %>
        <%= check_box_tag "study[content_ids][]", content.id, checked, id: "content_#{content.id}" %>
        <%= label_tag "content_#{content.id}", content.name %>
      </div>
    <% end %>
  </div>
  <% else %>
    <p>未完了の学習項目がありません。</p>
  <% end %>
  
  <div>
    <%= f.label :body, "学習内容" %><br>
    <%= f.text_area :body %>
  </div>

  <%= f.submit "記録する" %>
<% end %>

<hr>

<h2>その他操作</h2>

<ul>
  <li><%= link_to "学習項目の一覧へ", contents_path %></li>
  <li><%= link_to "学習項目を新しく追加する", new_content_path %></li>
</ul>